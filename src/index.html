<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wanz AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Inter",sans-serif;}
body{
    background:#f8f9fb;
    color:#111;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* HEADER */
.header{
    padding:20px 30px;
    background:white;
    border-bottom:1px solid #e5e7eb;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
.logo{
    font-size:22px;
    font-weight:700;
    background:linear-gradient(90deg,#4a90e2,#007dff);
    -webkit-background-clip:text;
    color:transparent;
}
.model-select{
    padding:8px 12px;
    border:1px solid #e5e7eb;
    border-radius:10px;
}

/* MAIN CHAT */
.chat-container{
    flex:1;
    padding:30px;
    overflow-y:auto;
}
.message{
    max-width:80%;
    padding:16px 20px;
    margin-bottom:18px;
    border-radius:18px;
    animation:fadeIn .2s ease;
}
.me{ background:#007dff; color:white; margin-left:auto; border-bottom-right-radius:4px; }
.ai{ background:white; border:1px solid #e5e7eb; border-bottom-left-radius:4px; }

/* LOADING DOTS */
.dots{
    width:50px;
    display:flex;
    justify-content:space-between;
}
.dots div{
    width:10px;
    height:10px;
    background:#007dff;
    border-radius:50%;
    animation:bounce 0.5s infinite alternate;
}
.dots div:nth-child(2){ animation-delay:0.15s; }
.dots div:nth-child(3){ animation-delay:0.3s; }

@keyframes bounce{
    from{ transform:translateY(0); opacity:1; }
    to{ transform:translateY(-7px); opacity:0.2; }
}

/* INPUT BAR */
.input-area{
    padding:20px;
    background:white;
    border-top:1px solid #e5e7eb;
    display:flex;
    gap:12px;
}
input{
    flex:1;
    padding:14px 16px;
    border-radius:12px;
    border:1px solid #dcdfe3;
    font-size:15px;
}
button{
    padding:14px 20px;
    background:#007dff;
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:600;
    transition:.2s;
}
button:hover{ background:#006be0; }

/* IMAGE & FILE FEATURES BOX */
.feature-box{
    display:flex;
    justify-content:center;
    gap:20px;
    margin-bottom:20px;
}
.feature{
    background:white;
    padding:14px 16px;
    border-radius:14px;
    border:1px solid #e5e7eb;
    cursor:pointer;
    transition:.2s;
}
.feature:hover{
    transform:scale(1.03);
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <div class="logo">‚ö° Wanz AI</div>
    <select class="model-select" id="model">
        <option value="gpt">ChatGPT</option>
        <option value="deepseek">DeepSeek</option>
        <option value="claude">Claude</option>
    </select>
</div>

<!-- FEATURE BUTTONS -->
<div class="feature-box">
    <div class="feature" onclick="selectImage()">üñºÔ∏è Generate Image</div>
    <div class="feature" onclick="selectFile()">üìÑ Analyze File</div>
</div>

<!-- CHAT -->
<div class="chat-container" id="chat"></div>

<!-- INPUT -->
<div class="input-area">
    <input id="msg" placeholder="Ketik pesan‚Ä¶" />
    <button onclick="sendMessage()">Kirim</button>
</div>

<script>
const chat = document.getElementById("chat");

/* --- Append Message --- */
function addMessage(text, sender){
    const div = document.createElement("div");
    div.className = "message " + sender;
    div.innerHTML = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* --- AI Loading Animation --- */
function addLoading(){
    const div = document.createElement("div");
    div.className = "message ai";
    div.id = "loading";
    div.innerHTML = `<div class="dots"><div></div><div></div><div></div></div>`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* --- Remove Loading --- */
function removeLoading(){
    const elem = document.getElementById("loading");
    if(elem) elem.remove();
}

/* --- SEND MESSAGE --- */
async function sendMessage(){
    const text = msg.value.trim();
    if(!text) return;

    addMessage(text, "me");
    msg.value = "";

    addLoading();

    const model = document.getElementById("model").value;

    const res = await fetch("/api/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            model,
            message:text
        })
    });

    const data = await res.json();
    removeLoading();

    addMessage(data.reply || "Error: tidak ada respon.", "ai");
}

/* --- IMAGE GENERATION --- */
async function selectImage(){
    const prompt = prompt("Masukkan prompt gambar:");
    if(!prompt) return;

    addMessage("üñºÔ∏è Generate: " + prompt, "me");
    addLoading();

    const res = await fetch("/api/image",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ prompt })
    });

    const data = await res.json();
    removeLoading();

    addMessage(`<img src="${data.url}" style="max-width:100%;border-radius:12px;">`, "ai");
}

/* --- FILE ANALYSIS --- */
async function selectFile(){
    const input = document.createElement("input");
    input.type="file";
    input.onchange = async () =>{
        const file = input.files[0];
        if(!file) return;

        addMessage("üìÑ Analyzing file: " + file.name, "me");
        addLoading();

        const form = new FormData();
        form.append("file", file);

        const res = await fetch("/api/analyze",{ method:"POST", body:form });
        const data = await res.json();

        removeLoading();
        addMessage(data.result, "ai");
    };
    input.click();
}

</script>

</body>
</html>
